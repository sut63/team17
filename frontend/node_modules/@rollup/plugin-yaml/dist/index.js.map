{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import YAML from 'js-yaml';\nimport toSource from 'tosource';\nimport { createFilter, makeLegalIdentifier } from '@rollup/pluginutils';\n\nconst defaults = {\n  documentMode: 'single',\n  safe: true,\n  transform: null\n};\nconst ext = /\\.ya?ml$/;\n\nexport default function yamll(opts = {}) {\n  const options = Object.assign({}, defaults, opts);\n  const { documentMode, safe } = options;\n  const filter = createFilter(options.include, options.exclude);\n  let loadMethod = null;\n\n  if (documentMode === 'single') {\n    loadMethod = safe ? YAML.load : YAML.safeLoad;\n  } else if (documentMode === 'multi') {\n    loadMethod = safe ? YAML.loadAll : YAML.safeLoadAll;\n  } else {\n    this.error(\n      `plugin-yaml â†’ documentMode: '${documentMode}' is not a valid value. Please choose 'single' or 'multi'`\n    );\n  }\n\n  return {\n    name: 'yaml',\n\n    transform(content, id) {\n      if (!ext.test(id)) return null;\n      if (!filter(id)) return null;\n\n      let data = loadMethod(content);\n\n      if (typeof options.transform === 'function') {\n        const result = options.transform(data);\n        // eslint-disable-next-line no-undefined\n        if (result !== undefined) {\n          data = result;\n        }\n      }\n\n      const keys = Object.keys(data).filter((key) => key === makeLegalIdentifier(key));\n      const code = `var data = ${toSource(data)};\\n\\n`;\n      const exports = ['export default data;']\n        .concat(keys.map((key) => `export var ${key} = data.${key};`))\n        .join('\\n');\n\n      return {\n        code: code + exports,\n        map: { mappings: '' }\n      };\n    }\n  };\n}\n"],"names":["defaults","documentMode","safe","transform","ext","yamll","opts","options","Object","assign","filter","createFilter","include","exclude","loadMethod","YAML","load","safeLoad","loadAll","safeLoadAll","error","name","content","id","test","data","result","undefined","keys","key","makeLegalIdentifier","code","toSource","exports","concat","map","join","mappings"],"mappings":";;;;;;;;AAIA,MAAMA,QAAQ,GAAG;AACfC,EAAAA,YAAY,EAAE,QADC;AAEfC,EAAAA,IAAI,EAAE,IAFS;AAGfC,EAAAA,SAAS,EAAE;AAHI,CAAjB;AAKA,MAAMC,GAAG,GAAG,UAAZ;AAEe,SAASC,KAAT,CAAeC,IAAI,GAAG,EAAtB,EAA0B;AACvC,QAAMC,OAAO,GAAGC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBT,QAAlB,EAA4BM,IAA5B,CAAhB;AADuC,QAE/BL,YAF+B,GAERM,OAFQ,CAE/BN,YAF+B;AAAA,QAEjBC,IAFiB,GAERK,OAFQ,CAEjBL,IAFiB;AAGvC,QAAMQ,MAAM,GAAGC,wBAAY,CAACJ,OAAO,CAACK,OAAT,EAAkBL,OAAO,CAACM,OAA1B,CAA3B;AACA,MAAIC,UAAU,GAAG,IAAjB;;AAEA,MAAIb,YAAY,KAAK,QAArB,EAA+B;AAC7Ba,IAAAA,UAAU,GAAGZ,IAAI,GAAGa,IAAI,CAACC,IAAR,GAAeD,IAAI,CAACE,QAArC;AACD,GAFD,MAEO,IAAIhB,YAAY,KAAK,OAArB,EAA8B;AACnCa,IAAAA,UAAU,GAAGZ,IAAI,GAAGa,IAAI,CAACG,OAAR,GAAkBH,IAAI,CAACI,WAAxC;AACD,GAFM,MAEA;AACL,SAAKC,KAAL,CACG,gCAA+BnB,YAAa,2DAD/C;AAGD;;AAED,SAAO;AACLoB,IAAAA,IAAI,EAAE,MADD;;AAGLlB,IAAAA,SAAS,CAACmB,OAAD,EAAUC,EAAV,EAAc;AACrB,UAAI,CAACnB,GAAG,CAACoB,IAAJ,CAASD,EAAT,CAAL,EAAmB,OAAO,IAAP;AACnB,UAAI,CAACb,MAAM,CAACa,EAAD,CAAX,EAAiB,OAAO,IAAP;AAEjB,UAAIE,IAAI,GAAGX,UAAU,CAACQ,OAAD,CAArB;;AAEA,UAAI,OAAOf,OAAO,CAACJ,SAAf,KAA6B,UAAjC,EAA6C;AAC3C,cAAMuB,MAAM,GAAGnB,OAAO,CAACJ,SAAR,CAAkBsB,IAAlB,CAAf,CAD2C;;AAG3C,YAAIC,MAAM,KAAKC,SAAf,EAA0B;AACxBF,UAAAA,IAAI,GAAGC,MAAP;AACD;AACF;;AAED,YAAME,IAAI,GAAGpB,MAAM,CAACoB,IAAP,CAAYH,IAAZ,EAAkBf,MAAlB,CAA0BmB,GAAD,IAASA,GAAG,KAAKC,+BAAmB,CAACD,GAAD,CAA7D,CAAb;AACA,YAAME,IAAI,GAAI,cAAaC,QAAQ,CAACP,IAAD,CAAO,OAA1C;AACA,YAAMQ,OAAO,GAAG,CAAC,sBAAD,EACbC,MADa,CACNN,IAAI,CAACO,GAAL,CAAUN,GAAD,IAAU,cAAaA,GAAI,WAAUA,GAAI,GAAlD,CADM,EAEbO,IAFa,CAER,IAFQ,CAAhB;AAIA,aAAO;AACLL,QAAAA,IAAI,EAAEA,IAAI,GAAGE,OADR;AAELE,QAAAA,GAAG,EAAE;AAAEE,UAAAA,QAAQ,EAAE;AAAZ;AAFA,OAAP;AAID;;AA3BI,GAAP;AA6BD;;;;"}